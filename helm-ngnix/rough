


argocd -domain ( like jenkins) map with loadbalancer
add cluster - cluster name should be there

pipeline {
    agent any
 
    environment {
        ARGOCD_SERVER = 'a1ab8b1e29dbb40b8a7a06a2554b4917-1413235132.ap-south-1.elb.amazonaws.com'
        ARGOCD_USERNAME = 'admin'
        ARGOCD_PASSWORD = 'Ecom@12345'
        REPO_URL = 'https://github.com/argoproj/argocd-example-apps.git'
        CHART_PATH = 'blue-green'
        CLUSTER_SERVER = 'https://CA8C816D71A8B6F6E5292B09BE14BD2B.gr7.ap-south-1.eks.amazonaws.com'
        APP_NAME = 'blue-green-app'
        NAMESPACE = 'default'
    }
 
    stages {
        stage('Login to ArgoCD') {
            steps {
                script {
                    sh '''
                    argocd login ${ARGOCD_SERVER} --username ${ARGOCD_USERNAME} --password ${ARGOCD_PASSWORD} --insecure
                    '''
                }
            }
        }
 
        stage('Create/Update ArgoCD Application') {
            steps {
                script {
                    sh '''
                    argocd app create ${APP_NAME} \
                    --repo ${REPO_URL} \
                    --path ${CHART_PATH} \
                    --dest-server ${CLUSTER_SERVER} \
                    --dest-namespace ${NAMESPACE} \
                    --sync-policy automated || true
                    '''
                }
            }
        }
 
        stage('Sync Application') {
            steps {
                script {
                    sh '''
                    argocd app sync ${APP_NAME}
                    '''
                }
            }
        }
    }
 
    post {
        success {
            echo 'Deployment completed successfully!'
        }
        failure {
            echo 'Deployment failed!'
        }
    }
}